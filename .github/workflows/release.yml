name: ğŸš€ Release FllameTape

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.0.0)'
        required: true
        type: string

jobs:
  create-release:
    name: ğŸ‰ Create Release
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v5

    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: âœ… Run tests before release
      run: |
        python -c "import metadata_extractor; print('âœ… Import test passed')"
        python -c "from metadata_extractor import Colors, TerminalUI; print('âœ… Component test passed')"

    - name: ğŸ“‹ Generate changelog
      id: changelog
      run: |
        echo "## ğŸ‰ FllameTape Release Notes" > CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "### ğŸ” What's New in This Release" >> CHANGELOG.md
        echo "- ğŸ¨ Enhanced terminal interface with custom UI" >> CHANGELOG.md
        echo "- ğŸ“± Cross-platform compatibility (Windows, macOS, Linux)" >> CHANGELOG.md
        echo "- ğŸ›¡ï¸ Improved security and error handling" >> CHANGELOG.md
        echo "- ğŸ“Š Professional metadata extraction capabilities" >> CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "### ğŸš€ Features" >> CHANGELOG.md
        echo "- ğŸ“· **Image Metadata**: EXIF data extraction from photos" >> CHANGELOG.md
        echo "- ğŸµ **Media Metadata**: Audio/video file analysis" >> CHANGELOG.md
        echo "- ğŸ“„ **PDF Metadata**: Document property extraction" >> CHANGELOG.md
        echo "- ğŸ¨ **Custom UI**: Beautiful terminal interface with animations" >> CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "### ğŸ”§ Technical Improvements" >> CHANGELOG.md
        echo "- Updated to modern pypdf library" >> CHANGELOG.md
        echo "- Enhanced error handling and user feedback" >> CHANGELOG.md
        echo "- Optimized performance and reliability" >> CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "### ğŸ‘¨â€ğŸ’» About the Author" >> CHANGELOG.md
        echo "**Created by [kiwuauaa](https://github.com/kiwuauaa)**" >> CHANGELOG.md
        echo "Digital forensics enthusiast and metadata extraction specialist" >> CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "### ğŸ“¥ Installation" >> CHANGELOG.md
        echo "\`\`\`bash" >> CHANGELOG.md
        echo "git clone https://github.com/kiwuauaa/FllameTape.git" >> CHANGELOG.md
        echo "cd FllameTape" >> CHANGELOG.md
        echo "pip install -r requirements.txt" >> CHANGELOG.md
        echo "python metadata_extractor.py" >> CHANGELOG.md
        echo "\`\`\`" >> CHANGELOG.md

    - name: ğŸ“¦ Create distribution package
      run: |
        mkdir -p dist
        cp metadata_extractor.py dist/
        cp requirements.txt dist/
        cp README.md dist/
        cp LICENSE dist/
        cd dist
        tar -czf ../FllameTape-${{ github.ref_name }}.tar.gz *
        zip -r ../FllameTape-${{ github.ref_name }}.zip *

    - name: ğŸ“Š Generate release assets
      run: |
        echo "# ğŸ” FllameTape - Digital Forensics Tool" > release_info.md
        echo "" >> release_info.md
        echo "**Version:** ${{ github.ref_name }}" >> release_info.md
        echo "**Author:** kiwuauaa" >> release_info.md
        echo "**Purpose:** Professional metadata extraction for digital forensics" >> release_info.md
        echo "" >> release_info.md
        echo "## ğŸ“¦ Download Options" >> release_info.md
        echo "- **Source Code (ZIP):** Complete source with all files" >> release_info.md
        echo "- **Source Code (TAR.GZ):** Unix-compatible archive" >> release_info.md
        echo "" >> release_info.md
        echo "## ğŸš€ Quick Start" >> release_info.md
        echo "1. Download and extract the source code" >> release_info.md
        echo "2. Install dependencies: \`pip install -r requirements.txt\`" >> release_info.md
        echo "3. Run the tool: \`python metadata_extractor.py\`" >> release_info.md

    - name: ğŸ‰ Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.ref_name }}
        name: "ğŸ” FllameTape ${{ github.ref_name }}"
        body_path: CHANGELOG.md
        files: |
          FllameTape-${{ github.ref_name }}.tar.gz
          FllameTape-${{ github.ref_name }}.zip
          release_info.md
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: ğŸ“¢ Post-release notification
      run: |
        echo "ğŸ‰ FllameTape ${{ github.ref_name }} has been released!"
        echo "ğŸ“¥ Download: https://github.com/kiwuauaa/FllameTape/releases/latest"
        echo "ğŸ” Created by: kiwuauaa"
        echo "ğŸ·ï¸ Purpose: Digital forensics metadata extraction"